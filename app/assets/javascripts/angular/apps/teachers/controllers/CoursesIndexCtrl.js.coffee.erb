CoursesIndexCtrl = ($location, $filter, $modal, SessionManager, AssetsPreloader, Utils, courses) ->
  @courses = courses

  @activeCourses = $filter('filter')(@courses, active: true)
  @inactiveCourses = $filter('filter')(@courses, active: false)

  @unregister = (course)->
    if confirm("Deseja mesmo sair da disciplina #{course.name}?")
      course.unregister().then ->
        Utils.remove(@courses, course)

  @openNewCourseForm = ->
    $modal.open
      templateUrl: '<%= asset_path('courses/new_course_form.html') %>'
      controller: 'NewCourseCtrl'

  if !SessionManager.currentUser().completed_tutorial
    <% tutorials = {1 => [1], 2 => [1,2], 3 => [1,2,3]} %>
    <% tutorials.each do |tutorial, steps| %>
      <% steps.each do |step| %>
        <% image = "tutorial/tutorial-arrow-#{tutorial}-#{step}.png" %>
        <%= "AssetsPreloader.loadImage(\"#{asset_path(image)}\")" %>
      <% end %>
    <% end %>
    AssetsPreloader.loadFont('Chalkduster')

  @
CoursesIndexCtrl.$inject = ['$location', '$filter', '$modal', 'SessionManager', 'AssetsPreloader', 'Utils', 'courses']

angular
  .module('DunnoApp')
  .controller('CoursesIndexCtrl', CoursesIndexCtrl)
