DunnoApp = angular.module('DunnoApp')
DunnoAppStudent = angular.module('DunnoAppStudent')

CatalogPickerCtrl = ($scope, $rootScope, MediaSearcher)->
  MediaSearcher.inject($scope)
  $rootScope.$on('$locationChangeStart', -> $scope.$emit("modal.dismiss"))

CatalogPickerCtrl.$inject = ['$scope', '$rootScope', 'MediaSearcher']

DunnoApp.controller 'CatalogPickerCtrl', CatalogPickerCtrl
DunnoAppStudent.controller 'CatalogPickerCtrl', CatalogPickerCtrl

catalogPicker = ->
  controller: 'CatalogPickerCtrl'
  templateUrl: '<%= asset_path('shared/catalog/_picker.html') %>'
  link: (scope, element, attrs)->
    scope.select = (media)->
      scope.$emit('catalog-picker.selected', media)
      scope.$broadcast('modal.dismiss')

    scope.$on 'catalog-picker.open', ->
      scope.$broadcast('modal.show')
      scope.fetch()

DunnoApp.directive 'catalogPicker', catalogPicker
DunnoAppStudent.directive 'catalogPicker', catalogPicker
