app.lessonPlan = angular.module('app.lessonPlan')

CatalogPickerCtrl = ($scope, $rootScope, MediaSearcher)->
  MediaSearcher.inject($scope)
  $rootScope.$on('$locationChangeStart', -> $scope.$emit("modal.dismiss"))

CatalogPickerCtrl.$inject = ['$scope', '$rootScope', 'MediaSearcher']

app.lessonPlan.controller 'CatalogPickerCtrl', CatalogPickerCtrl

catalogPicker = ->
  controller: 'CatalogPickerCtrl'
  templateUrl: '<%= asset_path('app/lesson-plan/new-topic/catalog-picker') %>'
  link: (scope, element, attrs)->
    scope.select = (media)->
      scope.$emit('catalog-picker.selected', media)
      scope.$broadcast('modal.dismiss')

    scope.$on 'catalog-picker.open', ->
      scope.$broadcast('modal.show')
      scope.fetch()

app.lessonPlan.directive 'catalogPicker', catalogPicker
