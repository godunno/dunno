CoursesIndexCtrl = ($location, $filter, ModalFactory, Utils, courses) ->
  @courses = courses

  @activeCourses   = @courses.filter (course) -> course.active
  @inactiveCourses = @courses.filter (course) -> !course.active

  @unregister = (course)->
    if confirm("Deseja mesmo sair da disciplina #{course.name}?")
      course.unregister().then ->
        Utils.remove(@courses, course)

  initializeNewCourseModal = =>
    @newCourseModal = new ModalFactory
      templateUrl: '<%= asset_path('app/courses/course-new.html') %>'
      contentScope:
        close: =>
          @newCourseModal.deactivate()

  initializeNewCourseModal()

  @openNewCourseForm = ->
    @newCourseModal.activate()

  @

CoursesIndexCtrl.$inject = ['$location', '$filter', 'ModalFactory', 'Utils', 'courses']

angular
  .module('app.courses')
  .controller('CoursesIndexCtrl', CoursesIndexCtrl)
